/*===================================================================================================================
 * @name: bPopup
 * @type: jQuery
 * @author: (c) Bjoern Klinggaard - @bklinggaard
 * @demo: http://dinbror.dk/bpopup
 * @version: 0.11.0
 * @requires jQuery 1.4.3
 *==================================================================================================================*/
define("popup",["_sbejquery"],function(b){b.fn.bPopup=function(A,F){function L(){a.contentContainer=b(a.contentContainer||c);switch(a.content){case "iframe":var d=b('<iframe class="b-iframe" '+a.iframeAttr+"></iframe>");d.appendTo(a.contentContainer);t=c.outerHeight(!0);u=c.outerWidth(!0);B();d.attr("src",a.loadUrl);l(a.loadCallback);C(b(this));break;case "image":B();b("<img />").load(function(){l(a.loadCallback);C(b(this))}).attr("src",a.loadUrl).hide().appendTo(a.contentContainer);break;default:B(),
    b('<div class="b-ajax-wrapper"></div>').load(a.loadUrl,a.loadData,function(d,c,e){l(a.loadCallback,c);C(b(this))}).hide().appendTo(a.contentContainer)}}function B(){a.modal&&b('<div class="b-modal '+e+'"></div>').css({backgroundColor:a.modalColor,position:"fixed",top:0,right:0,bottom:0,left:0,opacity:0,zIndex:a.zIndex+v}).appendTo(a.appendTo).fadeTo(a.speed,a.opacity);D();c.data("bPopup",a).data("id",e).css({left:"slideIn"==a.transition||"slideBack"==a.transition?"slideBack"==a.transition?f.scrollLeft()+
    w:-1*(x+u):m(!(!a.follow[0]&&n||g)),position:a.positionStyle||"absolute",top:"slideDown"==a.transition||"slideUp"==a.transition?"slideUp"==a.transition?f.scrollTop()+y:z+-1*t:p(!(!a.follow[1]&&q||g)),"z-index":a.zIndex+v+1}).each(function(){a.appending&&b(this).appendTo(a.appendTo)});G(!0)}function r(){a.modal&&b(".b-modal."+c.data("id")).fadeTo(a.speed,0,function(){b(this).remove()});a.scrollBar||b("html").css("overflow","auto");b(".b-modal."+e).unbind("click");f.unbind("keydown."+e);k.unbind("."+
    e).data("bPopup",0<k.data("bPopup")-1?k.data("bPopup")-1:null);c.undelegate(".bClose, ."+a.closeClass,"click."+e,r).data("bPopup",null);clearTimeout(H);G();return!1}function I(d){y=k.height();w=k.width();h=E();if(h.x||h.y)clearTimeout(J),J=setTimeout(function(){D();d=d||a.followSpeed;var e={};h.x&&(e.left=a.follow[0]?m(!0):"auto");h.y&&(e.top=a.follow[1]?p(!0):"auto");c.dequeue().each(function(){g?b(this).css({left:x,top:z}):b(this).animate(e,d,a.followEasing)})},50)}function C(d){var b=d.width(),
    e=d.height(),f={};a.contentContainer.css({height:e,width:b});e>=c.height()&&(f.height=c.height());b>=c.width()&&(f.width=c.width());t=c.outerHeight(!0);u=c.outerWidth(!0);D();a.contentContainer.css({height:"100%",width:"100%"});f.left=m(!(!a.follow[0]&&n||g));f.top=p(!(!a.follow[1]&&q||g));c.animate(f,250,function(){d.show();h=E()})}function M(){k.data("bPopup",v);c.delegate(".bClose, ."+a.closeClass,"click."+e,r);a.modalClose&&b(".b-modal."+e).css("cursor","pointer").bind("click",r);N||!a.follow[0]&&
!a.follow[1]||k.bind("scroll."+e,function(){if(h.x||h.y){var d={};h.x&&(d.left=a.follow[0]?m(!g):"auto");h.y&&(d.top=a.follow[1]?p(!g):"auto");c.dequeue().animate(d,a.followSpeed,a.followEasing)}}).bind("resize."+e,function(){I()});a.escClose&&f.bind("keydown."+e,function(a){27==a.which&&r()})}function G(d){function b(b){c.css({display:"block",opacity:1}).animate(b,a.speed,a.easing,function(){K(d)})}switch(d?a.transition:a.transitionClose||a.transition){case "slideIn":b({left:d?m(!(!a.follow[0]&&
    n||g)):f.scrollLeft()-(u||c.outerWidth(!0))-200});break;case "slideBack":b({left:d?m(!(!a.follow[0]&&n||g)):f.scrollLeft()+w+200});break;case "slideDown":b({top:d?p(!(!a.follow[1]&&q||g)):f.scrollTop()-(t||c.outerHeight(!0))-200});break;case "slideUp":b({top:d?p(!(!a.follow[1]&&q||g)):f.scrollTop()+y+200});break;default:c.stop().fadeTo(a.speed,d?1:0,function(){K(d)})}}function K(b){b?(M(),l(F),a.autoClose&&(H=setTimeout(r,a.autoClose))):(c.hide(),l(a.onClose),a.loadUrl&&(a.contentContainer.empty(),
    c.css({height:"auto",width:"auto"})))}function m(a){return a?x+f.scrollLeft():x}function p(a){return a?z+f.scrollTop():z}function l(a,e){b.isFunction(a)&&a.call(c,e)}function D(){z=q?a.position[1]:Math.max(0,(y-c.outerHeight(!0))/2-a.amsl);x=n?a.position[0]:(w-c.outerWidth(!0))/2;h=E()}function E(){return{x:w>c.outerWidth(!0),y:y>c.outerHeight(!0)}}b.isFunction(A)&&(F=A,A=null);var a=b.extend({},b.fn.bPopup.defaults,A);a.scrollBar||b("html").css("overflow","hidden");var c=this,f=b(document),k=b(window),
    y=k.height(),w=k.width(),N=/OS 6(_\d)+/i.test(navigator.userAgent),v=0,e,h,q,n,g,z,x,t,u,J,H;c.close=function(){r()};c.reposition=function(a){I(a)};return c.each(function(){b(this).data("bPopup")||(l(a.onOpen),v=(k.data("bPopup")||0)+1,e="__b-popup"+v+"__",q="auto"!==a.position[1],n="auto"!==a.position[0],g="fixed"===a.positionStyle,t=c.outerHeight(!0),u=c.outerWidth(!0),a.loadUrl?L():B())})};b.fn.bPopup.defaults={amsl:50,appending:!0,appendTo:"body",autoClose:!1,closeClass:"b-close",content:"ajax",
    contentContainer:!1,easing:"swing",escClose:!0,follow:[!0,!0],followEasing:"swing",followSpeed:500,iframeAttr:'scrolling="no" frameborder="0"',loadCallback:!1,loadData:!1,loadUrl:!1,modal:!0,modalClose:!0,modalColor:"#000",onClose:!1,onOpen:!1,opacity:.7,position:["auto","auto"],positionStyle:"absolute",scrollBar:!0,speed:250,transition:"fadeIn",transitionClose:!1,zIndex:9997}});

require(['popup']);