<?php
require_once dirname(__FILE__) . "/base_cli.php";

require_once dirname(__FILE__) . '/../../models/game_description/game_description_gspt.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_777.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_ag.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_agin.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_asialong.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_entwine.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_fg.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_gamesos.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_gsmg.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_hb.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_hrcc.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_impt.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_imslots.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_isb.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_oneworks.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_opus.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_sportsbook.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_qt.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_kuma.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_dt.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_idn.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_gameplay.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_og.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_gd.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_lapis.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_opus_sportsbook.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_bbin.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_bbin_fix_new_game.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_isb_freespin.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_opus_keno.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_ebet_bbin.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_sagaming.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_jumb.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_ttg.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_spadegaming.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_pragmaticplay.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_pt.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_whitelabel.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_mg.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_uc.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_png.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_kenogame.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_fishinggame.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_pinnacle.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_vr.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_evolution_gaming.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_ebetbbtech.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_yoplay.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_ebet_kuma.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_gameplay_sbtech.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_xyzblue_minigames.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_dg.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_lebo.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_yungu.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_ebet_ggfishing.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_ipm_v2_sportsbook.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_finance.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_onesgame.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_hg.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_ebet_ag.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_agshaba.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_agbbin.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_ld_casino.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_t1lottery.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_ld_lottery.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_ebet_opus.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_ebet_dt.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_extreme_live_gaming.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_ig.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_mg_dashur.php';
// require_once dirname(__FILE__) . '/../../models/game_description/game_description_pt_krw.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_ibc.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_ebet.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_ultraplay.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_genesism4.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_rtg.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_mwg.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_rwb.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_ezugi.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_ky.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_cq9.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_pgsoft.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_rtg_master.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_goldenf_pgsoft.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_legaming.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_tianhao.php';

# T1 API
require_once dirname(__FILE__) . '/../../models/game_description/game_description_ggpoker.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_ab.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_suncity.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_ls_casino.php';
require_once dirname(__FILE__) . '/../../models/game_description/game_description_tcg_lottery.php';

require_once dirname(__FILE__) . '/../modules/sync_command_module.php';

/**
 * General behaviors include :
 *
 * * sync game api
 *
 * @category Command line
 * @version 1.8.10
 * @copyright 2013-2022 tot
 */
class Sync extends Base_cli {

    use game_description_777;
    use game_description_ag;
    use game_description_agin;
    use game_description_asialong;
    use game_description_entwine;
    use game_description_fg;
    use game_description_gamesos;
    use game_description_gsmg;
    use game_description_gspt;
    use game_description_hb;
    use game_description_hrcc;
    use game_description_impt;
    use game_description_imslots;
    use game_description_isb;
    use game_description_oneworks;
    use game_description_opus;
    use game_description_sportsbook;
    use game_description_qt;
    use game_description_kuma;
    use game_description_dt;
    use game_description_idn;
    use game_description_gameplay;
    use game_description_lapis;
    use game_description_opus_keno;
    use game_description_og;
    use game_description_mg;
    use game_description_uc;
    use game_description_gd;
    use game_description_bbin;
    use game_description_bbin_fix_new_game;
    use game_description_isb_freespin;
    use game_description_ebet_bbin;
    use game_description_sagaming;
    use game_description_jumb;
    use game_description_ttg;
    use game_description_spadegaming;
    use game_description_pragmaticplay;
    use game_description_whitelabel;
    use game_description_kenogame;
    use game_description_opus_sportsbook;
    use game_description_agbbin;
    use game_description_pt;
    use game_description_png;
    use game_description_fishinggame;
    use game_description_pinnacle;
    use game_description_vr;
    use game_description_evolution_gaming;
    use game_description_ebetbbtech;
    use game_description_yoplay;
    use game_description_ebet_kuma;
    use game_description_gameplay_sbtech;
    use game_description_xyzblue_minigames;
    use game_description_dg;
    use game_description_lebo;
    use game_description_yungu;
    use game_description_ebet_ggfishing;
    use game_description_ipm_v2_sportsbook;
    use game_description_finance;
    use game_description_onesgame;
    use game_description_ld_casino;
    use game_description_t1lottery;
    use game_description_ld_lottery;
    use game_description_ebet_opus;
    use game_description_hg;
    use game_description_ebet_ag;
    use game_description_ebet_dt;
    use game_description_extreme_live_gaming;
    use game_description_agshaba;
    use game_description_ig;
    use game_description_mg_dashur;
    use game_description_legaming;
    // use game_description_pt_krw;
    use game_description_ibc;
    use game_description_ggpoker;
    use game_description_ebet;
    use game_description_ultraplay;
    use game_description_genesism4;
    use game_description_rtg;
    use game_description_mwg;
    use game_description_rwb;
    use game_description_ky;
    use game_description_cq9;
    use game_description_pgsoft;
    use game_description_rtg_master;
    use game_description_ls_casino;
    use game_description_goldenf_pgsoft;
    use game_description_tcg_lottery;
    use game_description_tianhao;

    # T1 APIS
    use game_description_ab;
    use game_description_suncity;
    use game_description_ezugi;

    use sync_command_module;

    const FLAG_TRUE = 1;
    const FLAG_FALSE = 0;

    const TAG_CODE_FISHING_GAME     = 'fishing_game';
    const TAG_CODE_SLOT             = 'slots';
    const TAG_CODE_LOTTERY          = 'lottery';
    const TAG_CODE_LIVE_DEALER      = 'live_dealer';
    const TAG_CODE_CASINO           = 'casino';
    const TAG_CODE_GAMBLE           = 'gamble';
    const TAG_CODE_TABLE_GAMES      = 'table_games';
    const TAG_CODE_TABLE_AND_CARDS  = 'table_and_cards';
    const TAG_CODE_CARD_GAMES       = 'card_games';
    const TAG_CODE_E_SPORTS         = 'e_sports';
    const TAG_CODE_FIXED_ODDS       = 'fixed_odds';
    const TAG_CODE_ARCADE           = 'arcade';
    const TAG_CODE_HORCE_RACING     = 'horce_racing';
    const TAG_CODE_PROGRESSIVES     = 'progressives';
    const TAG_CODE_SPORTS           = 'sports';
    const TAG_CODE_UNKNOWN_GAME     = 'unknown';
    const TAG_CODE_VIDEO_POKER      = 'video_poker';
    const TAG_CODE_POKER            = 'poker';
    const TAG_CODE_MINI_GAMES       = 'mini_games';
    const TAG_CODE_OTHER            = 'others';
    const TAG_CODE_SOFT_GAMES       = 'soft_games';
    const TAG_CODE_SCRATCH_CARD     = 'scratch_card';

    /**
     * overview : Command constructor. Initialize Data
     */
    public function __construct() {
        parent::__construct();

        // $this->config->set_item('app_debug_log', APPPATH . 'logs/sync.log');

        $this->config->set_item('print_log_to_console', true);

        if (empty($this->utils->getConfig('manual_game_list_sync'))) {
            $this->utils->debug_log("WARNING: manual_game_list_sync is not available, please use sync_game_list function on command.php");
            exit;
        }

        $default_sync_game_logs_max_time_second = $this->config->item('default_sync_game_logs_max_time_second');
        set_time_limit($default_sync_game_logs_max_time_second);

        $this->load->model(['player_model']);
    }

    /**
     * overview : export informations class
     */
    public function index() {
        ReflectionClass::export('Sync');
    }

    public function game_description($funcName){

        $self=$this;
        $cnt=0;
        $success= $this->player_model->dbtransOnly(function() use($self, $funcName, &$cnt){

            return $self->$funcName($cnt);

        });

        $this->utils->debug_log('update game '.$funcName, $success, $cnt);

        return $success;
    }
    /*
        example url:
            http://admin.og.local/cli/sync/sync_multiple_game_description?api_ids=72,39,43
        example input:
            api_ids=72,39,43 (72 indicates API Number,each api number must be separated by coma)
     */
    public function sync_multiple_game_description(){
        $api_ids = $this->input->get('api_ids');
        $api_ids = explode(',', $api_ids);

        if(in_array(AGIN_API, $api_ids)){
            $this->sync_game_description_agin();
        }
        if(in_array(AGBBIN_API, $api_ids)){
            $this->sync_game_description_agbbin();
        }
        if(in_array(ASIALONG_API, $api_ids)){
            $this->sync_game_description_asialong();
        }
        if(in_array(BBIN_API, $api_ids)){
            $this->sync_game_description_bbin();
        }
        if(in_array(EBET_BBIN_API, $api_ids)){
            $this->sync_game_description_ebet_bbin();
        }
        if(in_array(FG_API, $api_ids)){
            $this->sync_game_description_fg();
        }
        if(in_array(GAMEPLAY_API, $api_ids)){
            $this->sync_game_description_gameplay();
        }
        if(in_array(HB_API, $api_ids)){
            $this->sync_game_description_hb();
        }
        if(in_array(IPM_API, $api_ids)){
            $this->sync_game_description_sportsbook();
        }
        if(in_array(ISB_API, $api_ids)){
            $this->sync_game_description_isb();
        }
        if(in_array(IMPT_API, $api_ids)){
            $this->sync_game_description_impt();
        }
        if(in_array(JUMB_GAMING_API, $api_ids)){
            $this->sync_game_description_jumb();
        }
        if(in_array(KENOGAME_API, $api_ids)){
            $this->sync_game_description_kenogame();
        }
        if(in_array(LAPIS_API, $api_ids)){
            $this->sync_game_description_lapis();
        }
        if(in_array(MG_API, $api_ids)){
            $this->sync_game_description_mg();
        }
        if(in_array(OG_API, $api_ids)){
            $this->sync_game_description_og();
        }
        if(in_array(OPUS_API, $api_ids)){
            $this->sync_game_description_opus();
        }
        if(in_array(ONEWORKS_API, $api_ids)){
            $this->sync_game_description_oneworks();
        }
        if(in_array(PT_API, $api_ids)){
            $this->sync_game_description_pt();
        }
        if(in_array(QT_API, $api_ids)){
            $this->sync_game_description_qt();
        }
        if(in_array(SA_GAMING_API, $api_ids)){
            $this->sync_game_description_sagaming();
        }
        if(in_array(TTG_API, $api_ids)){
            $this->sync_game_description_ttg();
        }
        if(in_array(UC_API, $api_ids)){
            $this->sync_game_description_uc();
        }
        if(in_array(OPUS_SPORTSBOOK_API, $api_ids)){
            $this->sync_game_description_opus_sportsbook();
        }
        if(in_array(PNG_API, $api_ids)){
            $this->sync_game_description_png();
        }
        if(in_array(PINNACLE_API, $api_ids)){
            $this->sync_game_description_pinnacle();
        }
        if(in_array(AP_GAME_API, $api_ids)){
            $this->sync_game_description_pinnacle(AP_GAME_API);
        }
        if(in_array(EVOLUTION_GAMING_API, $api_ids)){
            $this->sync_game_description_evolution_gaming();
        }
        if(in_array(EBET_BBTECH_API, $api_ids)){
            $this->sync_game_description_ebetbbtech();
        }
        if(in_array(YOPLAY_API, $api_ids)){
            $this->sync_game_description_yoplay();
        }
        if(in_array(EBET_KUMA_API, $api_ids)){
            $this->sync_game_description_ebet_kuma();
        }
        if(in_array(GAMEPLAY_SBTECH_API, $api_ids)){
            $this->sync_game_description_gameplay_sbtech();
        }
        if(in_array(XYZBLUE_API, $api_ids)){
            $this->sync_game_description_xyzblue_minigames();
        }
        if(in_array(DG_API, $api_ids)){
            $this->sync_game_description_dg();
        }
        if(in_array(LEBO_GAME_API, $api_ids)){
            $this->sync_game_description_lebo();
        }
        if(in_array(YUNGU_GAME_API, $api_ids)){
            $this->sync_game_description_yungu();
        }
        if(in_array(EBET_GGFISHING_API, $api_ids)){
            $this->sync_game_description_ebetggfishing();
        }
        if(in_array(FINANCE_API, $api_ids)){
            $this->sync_game_description_finance();
        }
        if(in_array(LD_CASINO_API, $api_ids)){
            $this->sync_game_description_ld_casino();
        }
        if(in_array(T1lottery_API, $api_ids)){
            $this->sync_game_description_t1lottery();
        }
        if(in_array(HG_API, $api_ids)){
            $this->sync_game_description_hg();
        }
        if(in_array(LD_LOTTERY_API, $api_ids)){
            $this->sync_game_description_ld_lottery();
        }
        if(in_array(EBET_AG_API, $api_ids)){
            $this->sync_game_description_ebet_ag();
        }
        if(in_array(EBET_OPUS_API, $api_ids)){
            $this->sync_game_description_ebet_opus();
        }
        if(in_array(EBET_DT_API, $api_ids)){
            $this->sync_game_description_ebet_dt();
        }
        if(in_array(EXTREME_LIVE_GAMING_API, $api_ids)){
            $this->sync_game_description_extreme_live_gaming();
        }
        if(in_array(AGSHABA_API, $api_ids)){
            $this->sync_game_description_agshaba();
        }
        if(in_array(IG_API, $api_ids)){
            $this->sync_game_description_ig();
        }
        if(in_array(IBC_API, $api_ids)){
            $this->sync_game_description_ibc();
        }
        if(in_array(EBET_API, $api_ids)){
            $this->sync_game_description_ebet();
        }
        if(in_array(ULTRAPLAY_API, $api_ids)){
            $this->sync_game_description_ultraplay();
        }
        if(in_array(RWB_API, $api_ids)){
            $this->sync_game_description_rwb();
        }
        if(in_array(FG_ENTAPLAY_API, $api_ids)){
            $this->sync_game_description_fg_entaplay();
        }
        if(in_array(EZUGI_API, $api_ids)){
            $this->game_description_ezugi();
        }

        # T1 APIS
        if(in_array(T1PT_API, $api_ids)){
            $this->sync_game_description_pt_t1();
        }
        if(in_array(T1JUMB_API, $api_ids)){
            $this->sync_game_description_jumb_t1();
        }
        if(in_array(T1YOPLAY_API, $api_ids)){
            $this->sync_game_description_yoplay_t1();
        }
        if(in_array(T1GG_API, $api_ids)){
            $this->sync_game_description_fishinggame_t1();
        }
        if(in_array(T1MG_API, $api_ids)){
            $this->sync_game_description_mg_t1();
        }
        if(in_array(T1DG_API, $api_ids)){
            $this->sync_game_description_dg_t1();
        }
        if(in_array(T1PRAGMATICPLAY_API, $api_ids)){
            $this->sync_game_description_pragmaticplay_t1();
        }
        if(in_array(T1AGIN_API, $api_ids)){
            $this->sync_game_description_agin_t1();
        }
        if(in_array(T1SPADE_GAMING_API, $api_ids)){
            $this->sync_game_description_spadegaming_t1();
        }
        if(in_array(T1VR_API, $api_ids)){
            $this->sync_game_description_vr_t1();
        }
        if(in_array(T1LOTTERY_EXT_API, $api_ids)){
            $this->sync_game_description_t1lottery_t1();
        }
        if(in_array(T1DT_API, $api_ids)){
            $this->sync_game_description_dt_t1();
        }
        if(in_array(GGPOKER_GAME_API, $api_ids)){
            $this->sync_game_description_ggpoker();
        }
        if(in_array(T1AB_API, $api_ids)){
            $this->sync_game_description_ab_t1();
        }
        if(in_array(T1GD_API, $api_ids)){
            $this->sync_game_description_gd_t1();
        }
        if(in_array(T1FG_ENTAPLAY_API, $api_ids)){
            $this->sync_game_description_fg_entaplay_t1();
        }
        if(in_array(T1ONEWORKS_API, $api_ids)){
            $this->sync_game_description_oneworks_t1();
        }
        if(in_array(T1IPM_V2_SPORTS_API, $api_ids)){
            $this->sync_game_description_ipm_v2_sportsbook_t1();
        }
        if(in_array(T1KYCARD_API, $api_ids)){
            $this->sync_game_description_ky_t1();
        }
        if(in_array(T1SUNCITY_API, $api_ids)){
            $this->sync_game_description_suncity_t1();
        }
        if(in_array(T1SA_GAMING_API, $api_ids)){
            $this->sync_game_description_sagaming_t1();
        }
        if(in_array(GENESISM4_GAME_API, $api_ids)){
            $this->sync_game_description_genesism4();
        }
        if(in_array(LS_CASINO_GAME_API, $api_ids)){
            $this->sync_game_description_ls_casino();
        }
        if(in_array(MG_DASHUR_API, $api_ids)){
            $this->sync_game_description_mg_dashur();
        }
        if(in_array(TCG_API, $api_ids)){
            $this->sync_game_description_tcg_lottery();
        }
        if(in_array(TIANHAO_API, $api_ids)){
            $this->sync_game_description_tianhao();
        }
    }

    public function postSyncGameDescription(){
        $this->config->set_item('print_log_to_console', false);
        $this->load->model('game_type_model');

        $game_list = $this->input->post('game_list');

        $game_list = openssl_decrypt(base64_decode($game_list), "AES-256-CBC", '123456123456', 0, '1234567890123456');

        $game_list = json_decode($game_list,true);

        foreach ($game_list as $key => $game) {
            #add game type id
            unset($game_list[$key]['game_type_id']);
            $game_list[$key]['game_type_id'] = $this->game_type_model->getGameTypeId($game['game_type'],$game['game_platform_id']);
        }

        $this->load->model(['game_description_model']);
        $success=$this->game_description_model->syncGameDescription($game_list);

        header("Content-Type: application/json");
        header("Access-Control-Allow-Methods: GET, POST");
        header("Access-Control-Expose-Headers: Access-Control-Allow-Origin");
        header("Access-Control-Allow-Credentials: true");

        echo json_encode($success);

    }

    /**
     * [sync_game_provider_game_list description]
     * @param  [string] $game_providers [can sync multiple game provider]
     * @return [json]                   [result of game sync]
     * How to use this function:
     * command: sudo ./sync.sh sync_game_provider_game_list <paramaters>
     * For parameters should be the defined game api name (don't need to put _API) or the defined value: spade_gaming or 220
     * If games are T1 and Ebet parameters should be with `-` like (t1-pt or ebet-spade_gaming)
     */
    public function sync_game_provider_game_list($game_providers=null,$override_mobile_attributes = null){
        $this->load->model(['game_type_model','game_description_model']);
        $this->game_list_valid_fields = array_keys(GAME_DESCRIPTION_MODEL::GAME_LIST_VALID_FIELDS_WITH_LIMIT);
        $fields_datatypes = [
            "int" => ["game_type_id","game_platform_id","related_game_desc_id","game_order"],
            "boolean" => ["flag_show_in_site","enabled_on_ios","enabled_on_android","progressive","html_five_enabled","flash_enabled","flag_new_game","dlc_enabled","mobile_enabled","enabled_freespin","status","void_bet","no_cash_back"],
            "text" => ["game_name","english_name","attributes","demo_link","game_code","external_game_id","client_id","moduleid","sub_game_provider","note"],
        ];

        $directory = dirname(__FILE__) . '/../../../../submodules/game-lib/models/game_description/json_data';
        $json_files = array_diff(scandir($directory), array('..', '.'));
        $is_exist = false;

        if (empty($game_providers)) {
            $result = [
                "Please put Game Platform ID or Game Provider Name",
                "Sample to launch: sync_game_provider_game_list/{pt} or {1}",
                "List of available Game provider"=>$json_files
            ];
            return $this->showErrorMessage($result);
        }

        if (count($json_files) == 0) {
            $result = ["Note" => "No available game list."];
            return $this->showErrorMessage($result);
        }

        $game_tags = $this->CI->game_type_model->getAllGameTags();
        $game_providers = explode('.', urldecode($game_providers));

        foreach ($game_providers as $game_provider) {

            #check if game have the same game list from other api
            #sample: T1PT -> PT
            $game_provider_arr = explode("-", $game_provider);
            if (count($game_provider_arr) > 1) {
                $real_game_provider = str_replace("-", "", $game_provider);
                $this->processFileDetails($game_provider,$real_game_provider);

                $real_game_platform_id = @constant(strtoupper($real_game_provider));
                #check if api exist on apis.php
                if (empty(@constant(strtoupper($real_game_provider)))) {
                    $temp_game_provider_arr = explode("_", $real_game_provider);
                    $real_game_platform_id = @constant(strtoupper($temp_game_provider_arr[0]));

                    #double check if api exist on apis.php
                    if (empty(@constant(strtoupper($temp_game_provider_arr[0])))) {
                        $result = [
                            "Note"=>"ERROR Game Provider: [".$real_game_provider."] not found (not defined)!",
                            "List of available Game provider"=>$json_files
                        ];
                        return $this->showErrorMessage($result);
                    }
                }
            }

            foreach ($json_files as $file_name) {
                $file_name_arr = explode("-", str_replace(".json", "", $file_name));
                $game_platform_id = $file_name_arr[1];

                if (in_array($game_provider, $file_name_arr)) {
                    $is_exist = true;

                    $game_list_data = file_get_contents($directory . "/". $file_name);
                    if (empty($this->validateGameJsonFormat($game_list_data))) continue;
                    $game_list = json_decode($game_list_data,true);

                    if (isset($real_game_platform_id)) {
                        $game_platform_id = $real_game_platform_id;
                    }

                    #get game_type_id ids
                    $game_types = array_unique(array_column($game_list, 'game_type_code'));
                    $temp_game_types = $this->process_game_type_id($game_types,$game_tags,$game_platform_id);

                    $game_external_game_ids = [];
                    foreach ($game_list as &$game) {

                        #redefined game platform_id
                        $game['game_platform_id'] = $game_platform_id;

                        $game['game_type_id'] = @$temp_game_types[$game['game_type_code']]['game_type_id'];
                        if (empty($game['game_type_id'])) {
                            $this->utils->debug_log("ERROR game_type_code not valid =======>",$game['game_type_code']);
                            $game = null;
                            continue;
                        }
                        unset($game['game_type_code']);

                        if (!in_array($game['external_game_id'], $game_external_game_ids)) {
                            array_push($game_external_game_ids, $game['external_game_id']);
                        }else{
                            $this->utils->debug_log("ERROR duplicate game =======>",$game['external_game_id']);
                            $game=null;
                            continue;
                        }

                        $isFieldsAreValid = $this->checkIfFieldsAreValid($game,$fields_datatypes);
                        if (empty($isFieldsAreValid))
                            $game = null;

                    }
                    $success=$this->game_description_model->syncGameDescription($game_list,null,null,null,$override_mobile_attributes);
                    unset($game_list,$game_external_game_ids);
                }
            }
        }

        if (empty($is_exist)) {
            $result = [
                "Note"=>"ERROR Game Provider: [".$game_provider."] not found on game list!",
                "List of available Game provider"=>$json_files
            ];

            // $this->utils->debug_log($result);
            return $this->showErrorMessage($result);
        }

    }

    /**
     * [processFileDetails checking for which file to use]
     * @param  [string] $game_provider [file name to sync]
     * @return [array]                [description]
     */
    private function processFileDetails(&$game_provider,&$real_game_provider){
        $game_provider_arr = explode('-', $game_provider);

        switch ($game_provider) {
            case 'gs-pt_api':
                $real_game_provider = "gspt_api";
                $game_provider = "impt_api";
                break;
            case 't1-jumb_gaming_api':
                $real_game_provider = "t1jumb_api";
                $game_provider = "jumb_gaming_api";
                break;
            case 'ebet-MG':
                $real_game_provider = "ebet_mg_api";
                $game_provider = "lapis_api";
                break;
            case 't1-gg_api':
            case 't1-fishinggame_api':
                $real_game_provider = "t1gg_api";
                $game_provider = "fishinggame_api";
                break;
            case 'entaplay-fg_api':
                $real_game_provider = "fg_entaplay_api";
                $game_provider = "fg_api";
                break;
            case 't1-fg_entaplay_api':
                $real_game_provider = "t1fg_entaplay_api";
                $game_provider = "fg_api";
                break;
            case 'fada-ld_lottery_api':
                $real_game_provider = "fada_ld_lottery_api";
                $game_provider = "ld_lottery_api";
                break;
            case 'thb-ebet_api':
                $real_game_provider = "ebet_thb_api";
                $game_provider = "ebet_api";
                break;
            case 'usd-ebet_api':
                $real_game_provider = "ebet_usd_api";
                $game_provider = "ebet_api";
                break;
            case 'bti-sbtech_api':
                $real_game_provider = "sbtech_bti_api";
                $game_provider = "sbtech_api";
                break;
            case 't1-evolution_api':
                $real_game_provider = "t1evolution_api";
                $game_provider = "evolution_gaming_api";
                break;
            case 'mtech-og_api': // MTECH_OG_API
                $real_game_provider = "mtech_og_api";
                $game_provider = "og_api";
                break;
            case 'mtech-hb_api': // MTECH_HB_API
                $real_game_provider = "mtech_hb_api";
                $game_provider = "hb_api";
                break;
            case 'idr1-hb_api': // HB_IDR1_API
                $real_game_provider = "hb_idr1_api";
                $game_provider = "hb_api";
                break;
            case 'idr2-hb_api': // HB_IDR2_API
                $real_game_provider = "hb_idr2_api";
                $game_provider = "hb_api";
                break;
            case 'idr3-hb_api': // HB_IDR3_API
                $real_game_provider = "hb_idr3_api";
                $game_provider = "hb_api";
                break;
            case 'idr4-hb_api': // HB_IDR4_API
                $real_game_provider = "hb_idr4_api";
                $game_provider = "hb_api";
                break;
            case 'idr5-hb_api': // HB_IDR5_API
                $real_game_provider = "hb_idr5_api";
                $game_provider = "hb_api";
                break;
            case 'idr6-hb_api': // HB_IDR6_API
                $real_game_provider = "hb_idr6_api";
                $game_provider = "hb_api";
                break;
            case 'thb2-hb_api': // HB_THB2_API
                $real_game_provider = "hb_thb2_api";
                $game_provider = "hb_api";
                break;
            case 'vnd2-hb_api': // HB_VND2_API
                $real_game_provider = "hb_vnd2_api";
                $game_provider = "hb_api";
                break;
                break;
            case 'vnd3-hb_api': // HB_VND3_API
                $real_game_provider = "hb_vnd3_api";
                $game_provider = "hb_api";
                break;
            case 'cny2-hb_api': // HB_CNY2_API
                $real_game_provider = "hb_cny2_api";
                $game_provider = "hb_api";
                break;
            case 'myr2-hb_api': // HB_MYR2_API
                $real_game_provider = "hb_myr2_api";
                $game_provider = "hb_api";
                break;
            case 'thb2-pragmaticplay_api': // PRAGMATICPLAY_THB2_API
                $real_game_provider = "pragmaticplay_thb2_api";
                $game_provider = "pragmaticplay_api";
                break;
            case 'idr1-pragmaticplay_api': // PRAGMATICPLAY_IDR1_API
                $real_game_provider = "pragmaticplay_idr1_api";
                $game_provider = "pragmaticplay_api";
                break;
            case 'idr2-pragmaticplay_api': // PRAGMATICPLAY_IDR2_API
                $real_game_provider = "pragmaticplay_idr2_api";
                $game_provider = "pragmaticplay_api";
                break;
            case 'idr3-pragmaticplay_api': // PRAGMATICPLAY_IDR3_API
                $real_game_provider = "pragmaticplay_idr3_api";
                $game_provider = "pragmaticplay_api";
                break;
            case 'idr4-pragmaticplay_api': // PRAGMATICPLAY_IDR4_API
                $real_game_provider = "pragmaticplay_idr4_api";
                $game_provider = "pragmaticplay_api";
                break;
            case 'vnd2-pragmaticplay_api': // PRAGMATICPLAY_VND2_API
                $real_game_provider = "pragmaticplay_vnd2_api";
                $game_provider = "pragmaticplay_api";
                break;
            case 'cny2-pragmaticplay_api': // PRAGMATICPLAY_CNY2_API
                $real_game_provider = "pragmaticplay_cny2_api";
                $game_provider = "pragmaticplay_api";
                break;
            case 'myr2-pragmaticplay_api': // PRAGMATICPLAY_MYR2_API
                $real_game_provider = "pragmaticplay_myr2_api";
                $game_provider = "pragmaticplay_api";
                break;
            case 'thb1-hb_api': // HB_THB1_API
                $real_game_provider = "hb_thb1_api";
                $game_provider = "hb_api";
                break;
            case 'vnd1-hb_api': // HB_VND1_API
                $real_game_provider = "hb_vnd1_api";
                $game_provider = "hb_api";
                break;
            case 'cny1-hb_api': // HB_CNY1_API
                $real_game_provider = "hb_cny1_api";
                $game_provider = "hb_api";
                break;
            case 'myr1-hb_api': // HB_MYR1_API
                $real_game_provider = "hb_myr1_api";
                $game_provider = "hb_api";
                break;
            case 'idr1-mgplus_api': // MGPLUS_IDR1_API
                $real_game_provider = "mgplus_idr1_api";
                $game_provider = "mgplus_api";
                break;
            case 'idr2-mgplus_api': // MGPLUS_IDR2_API
                $real_game_provider = "mgplus_idr2_api";
                $game_provider = "mgplus_api";
                break;
            case 'idr3-mgplus_api': // MGPLUS_IDR3_API
                $real_game_provider = "mgplus_idr3_api";
                $game_provider = "mgplus_api";
                break;
            case 'idr4-mgplus_api': // MGPLUS_IDR4_API
                $real_game_provider = "mgplus_idr4_api";
                $game_provider = "mgplus_api";
                break;
            case 'thb2-mgplus_api': // MGPLUS_THB2_API
                $real_game_provider = "mgplus_thb2_api";
                $game_provider = "mgplus_api";
                break;
            case 'vnd2-mgplus_api': // MGPLUS_VND2_API
                $real_game_provider = "mgplus_vnd2_api";
                $game_provider = "mgplus_api";
                break;
            case 'cny2-mgplus_api': // MGPLUS_CNY2_API
                $real_game_provider = "mgplus_cny2_api";
                $game_provider = "mgplus_api";
                break;
            case 'myr2-mgplus_api': // MGPLUS_MYR2_API
                $real_game_provider = "mgplus_myr2_api";
                $game_provider = "mgplus_api";
                break;
            case 'thb1-pragmaticplay_api': // PRAGMATICPLAY_THB1_API
                $real_game_provider = "pragmaticplay_thb1_api";
                $game_provider = "pragmaticplay_api";
                break;
            case 'vnd1-pragmaticplay_api': // PRAGMATICPLAY_VND1_API
                $real_game_provider = "pragmaticplay_vnd1_api";
                $game_provider = "pragmaticplay_api";
                break;
            case 'cny1-pragmaticplay_api': // PRAGMATICPLAY_CNY1_API
                $real_game_provider = "pragmaticplay_cny1_api";
                $game_provider = "pragmaticplay_api";
                break;
            case 'myr1-pragmaticplay_api': // PRAGMATICPLAY_MYR1_API
                $real_game_provider = "pragmaticplay_myr1_api";
                $game_provider = "pragmaticplay_api";
                break;
            case 'idr1-isb_api': // ISB_IDR1_API ISB_IDR2_API
                $real_game_provider = "isb_idr1_api";
                $game_provider = "isb_api";
                break;
            case 'idr2-isb_api': // ISB_IDR2_API
                $real_game_provider = "isb_idr2_api";
                $game_provider = "isb_api";
                break;
            case 'idr3-isb_api': // ISB_IDR3_API
                $real_game_provider = "isb_idr3_api";
                $game_provider = "isb_api";
                break;
            case 'idr4-isb_api': // ISB_IDR4_API
                $real_game_provider = "isb_idr4_api";
                $game_provider = "isb_api";
                break;
            case 'cny2-isb_api': // ISB_CNY2_API
                $real_game_provider = "isb_cny2_api";
                $game_provider = "isb_api";
                break;
            case 'thb2-isb_api': // ISB_THB2_API
                $real_game_provider = "isb_thb2_api";
                $game_provider = "isb_api";
                break;
            case 'vnd2-isb_api': // ISB_VND2_API
                $real_game_provider = "isb_vnd2_api";
                $game_provider = "isb_api";
                break;
            case 'myr2-isb_api': // ISB_MYR2_API
                $real_game_provider = "isb_myr2_api";
                $game_provider = "isb_api";
                break;
            case 'cny1-isb_api': // ISB_CNY1_API
                $real_game_provider = "isb_cny1_api";
                $game_provider = "isb_api";
                break;
            case 'thb1-isb_api': // ISB_THB1_API
                $real_game_provider = "isb_thb1_api";
                $game_provider = "isb_api";
                break;
            case 'myr1-isb_api': // ISB_MYR1_API
                $real_game_provider = "isb_myr1_api";
                $game_provider = "isb_api";
                break;
            case 'vnd1-isb_api': // ISB_VND1_API
                $real_game_provider = "isb_vnd1_api";
                $game_provider = "isb_api";
                break;
            case 'thb1-mgplus_api': // MGPLUS_THB1_API
                $real_game_provider = "mgplus_thb1_api";
                $game_provider = "mgplus_api";
                break;
            case 'vnd1-mgplus_api': // MGPLUS_VND1_API
                $real_game_provider = "mgplus_vnd1_api";
                $game_provider = "mgplus_api";
                break;
            case 'cny1-mgplus_api': // MGPLUS_CNY1_API
                $real_game_provider = "mgplus_cny1_api";
                $game_provider = "mgplus_api";
                break;
            case 'myr1-mgplus_api': // MGPLUS_MYR1_API
                $real_game_provider = "mgplus_myr1_api";
                $game_provider = "mgplus_api";
                break;
             case 't1-ezugi_api':
                $real_game_provider = "t1ezugi_api";
                $game_provider = "ezugi_api";
                break;
            default :
                $game_provider = $game_provider_arr[1];
                break;
        }
    }

    /**
     * [checkIfFieldsAreValid
     *  - check if all required fields exist
     *  - check if all fields are valid
     *  - check min and max input per field
     * ]
     * @param  [array] &$game            [game attributes]
     * @param  [array] $fields_datatypes [fields with datatypes]
     * @return [boolean]                   [description]
     */
    private function checkIfFieldsAreValid(&$game,$fields_datatypes){
        $success = true;
        $game_fields = array_keys($game);
        $missing_required_fields = $min_max_result = [];
        foreach (GAME_DESCRIPTION_MODEL::GAME_LIST_REQUIRED_FIELDS as $required_field) {
            if (!in_array($required_field, $game_fields)) {
                array_push($missing_required_fields, $required_field);
            }
        }

        foreach ($game_fields as $field) {
            if ($field == "release_date") {
                //ignore
               continue;
            }
            if (!in_array($field, $this->game_list_valid_fields)){
                $success = false;
                $this->utils->debug_log("ERROR Invalid Field ======>[external_game_id=".$game['external_game_id']."]",$field);
            }

            if (in_array($field, $fields_datatypes['text'])) {
                if (strlen($game[$field]) > GAME_DESCRIPTION_MODEL::GAME_LIST_VALID_FIELDS_WITH_LIMIT[$field]['max']) {
                    array_push($min_max_result, [$field=>strlen($game[$field])]);
                    $success = false;
                }
            }

            if (in_array($field, $fields_datatypes['int']) || in_array($field, $fields_datatypes['boolean'])) {
                if ((int)$game[$field] > (int)GAME_DESCRIPTION_MODEL::GAME_LIST_VALID_FIELDS_WITH_LIMIT[$field]['max']) {
                    array_push($min_max_result, [$field=>$game[$field]]);
                    $success = false;
                }
                if ((int)$game[$field] < (int)GAME_DESCRIPTION_MODEL::GAME_LIST_VALID_FIELDS_WITH_LIMIT[$field]['min']) {
                    $game[$field]= false;
                }
            }

        }

        if (count($min_max_result) > 0)
            $this->utils->debug_log("ERROR Min/Max not met ======>[external_game_id=".$game['external_game_id']."]",$min_max_result);

        if (count($missing_required_fields) > 0)
            $this->utils->debug_log("ERROR Missing Required Field[s] ======>[external_game_id=".$game['external_game_id']."]",$missing_required_fields);

        unset($missing_required_fields,$min_max_result);
        return $success;
    }

    /**
     * [validateGameJsonFormat validate if game list json is valid]
     * @param  [string] $directory [path of the file]
     * @param  [string] $file_name [file name]
     * @return [boolean]            [description]
     */
    private function validateGameJsonFormat($game_list){
        $game_list = json_decode($game_list);

        $success = false;
        switch (json_last_error()) {
            case JSON_ERROR_NONE:
                $success = true;
            break;
            case JSON_ERROR_DEPTH:
                $message = ' - Maximum stack depth exceeded';
            break;
            case JSON_ERROR_STATE_MISMATCH:
                $message = ' - Underflow or the modes mismatch';
            break;
            case JSON_ERROR_CTRL_CHAR:
                $message = ' - Unexpected control character found';
            break;
            case JSON_ERROR_SYNTAX:
                $message = ' - Syntax error, malformed JSON';
            break;
            case JSON_ERROR_UTF8:
                $message = ' - Malformed UTF-8 characters, possibly incorrectly encoded';
            break;
            default:
                $message = ' - Unknown error';
            break;
        }
        if (!empty($message))
            $this->utils->debug_log("ERROR validateGameJsonFormat =======>",$message);

        return $success;
    }

    /**
     * [process_game_type_id description]
     * @param  [array] $game_types       [list of game types from game list]
     * @param  [array] $game_tags        [list of game tags from game_tags table]
     * @param  [int] $game_platform_id [defined system id]
     * @return [int]                   [returns game_type_id]
     */
    private function process_game_type_id($game_types,$game_tags,$game_platform_id){
        $temp_game_types = [];
        foreach ($game_types as $game_type) {
            foreach ($game_tags as $key => $game_tag) {
                if ($game_type == $game_tag['tag_code']) {

                    $extra =[
                        'game_type' => $game_tag['tag_name'],
                        'game_type_code' => $game_tag['tag_code'],
                    ];

                    $temp_game_types[$game_type]=[
                        'game_type_id' => $this->game_type_model->checkGameType($game_platform_id,$game_tag['tag_name'],$extra),
                    ];
                }
            }

            if ($game_type =='yoplay' && in_array($game_platform_id, [AGIN_API,T1AGIN_API])) {
                $game_type_name = $extra['game_type'] = '_json:{"1":"Yoplay","2":"Yoplay","3":"Yoplay","4":"Yoplay","5":"Yoplay"}';
                $extra['game_type_code'] = "yoplay";
                $temp_game_types[$game_type]=[
                    'game_type_id' => $this->game_type_model->checkGameType($game_platform_id,$game_type_name,$extra),
                ];
            }

            if ($game_type =='tip' && in_array($game_platform_id, [BBIN_API,GSBBIN_API,T1BBIN_API,AGBBIN_API])) {
                $game_type_name = $extra['game_type'] = '_json:{"1":"BB Tip","2":"BB 小费","3":"BB Tip","4":"BB Tip","5":"BB Tip"}';
                $temp_game_types[$game_type]=[
                    'game_type_id' => $this->game_type_model->checkGameType($game_platform_id,$game_type_name,$extra),
                ];
            }
        }

        return $temp_game_types;
    }

    private function showErrorMessage($result){

        $result["Reminder"] = [
            "How to use this function:",
            "command: sudo ./sync.sh sync_game_provider_game_list <paramaters>",
            "For parameters should be the defined game api name or the defined value: spade_gaming_api or 220",
            "If games are T1 or Ebet parameters should be with `-` like (t1-pt_api or ebet-spade_gaming_api)"
        ];

        $this->utils->debug_log("ERROR",$result);

        $this->output->set_header('Access-Control-Allow-Origin: *');
        $this->output->set_content_type('application/json');
        $this->output->set_output(json_encode($result, JSON_PRETTY_PRINT));
    }

}
