<style type="text/css">
    .modal-dialog {
        width: 90%;
        margin: 30px auto;
    }
    .w-100{
        width: 100%;
    }

</style>
<div class="clearfix">
    <div class="panel panel-primary">
        <?php if ($this->utils->isEnabledFeature('enable_c6_acuris_api_authentication') && $this->permissions->checkPermissions('manual_generate_c6_authentication')) : ?>
                <label class="col-md-6">
                    <input type="checkbox" name="chkAutoUpdatePlayerStatus" id="chkAutoUpdatePlayerStatus" value="1" <?= (!$enable_auto_update_player_status_pep) ? "checked" : "" ?> onChange="autoUpdatePlayerStatus();">
                    <?= lang('Auto Update Player Status') ?>
                </label>
        <?php endif; ?>
        <div class="panel panel-body">
            <div class="table-responsive w-100">
                <table id="c6-auth-table" class="table table-bordered" style="margin-bottom:0;">
                    <thead>
                        <tr>
                            <th class="active"><?=lang('lang.date')?></th>
                            <th class="active"><?=lang('Score')?></th>
                            <th class="active"><?=lang('Person ID')?></th>
                            <th class="active"><?=lang('PEP')?></th>
                            <th class="active"><?=lang('Previous Sanctions')?></th>
                            <th class="active"><?=lang('Current Sanctions')?></th>
                            <th class="active"><?=lang('Law Enforcement')?></th>
                            <th class="active"><?=lang('Financial Regulator')?></th>
                            <th class="active"><?=lang('Insolvency')?></th>
                            <th class="active"><?=lang('Disqualified Director')?></th>
                            <th class="active"><?=lang('Adverse Media')?></th>
                            <th class="active"><?=lang('Details')?></th>
                            <th class="active"><?=lang('Generated By')?></th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>


    <?php if($this->utils->isEnabledFeature('enable_c6_acuris_api_authentication') && $this->permissions->checkPermissions('manual_generate_c6_authentication')) : ?>
        <center id="btn_manual_pep_auth">
            <input type="submit" class="btn btn-primary submit_btn btn-sm" value="<?=lang('Generate New C6 Authentication');?>" onclick="manual_player_c6_status()">
        </center>
    <?php endif; ?>
</div>

<div id="overlay" class="data-info-overlay">
    <div class="data-info-container">
        <a href="javascript:void(0)" class="closebtn pull-right" onclick="return close_details()">&times;</a>
        <div class="data-info">
            <div class="row basic_info_elements">
                <div class="col-md-2"><img src="https://dummyimage.com/150x150/000/fff" class="image_url"></div>
                <div class="col-md-3">
                    <p><strong><?= lang("ID")?>:</strong> <span class="person_id"></span></p>
                    <p><strong><?= lang("Title")?>:</strong> <span class="title"></span></p>
                    <p><strong><?= lang("Alternate Title")?>:</strong> <span class="alternative_title"></span></p>
                    <p><strong><?= lang("Forename")?>:</strong> <span class="forename"></span></p>
                    <p><strong><?= lang("Middlename")?>:</strong> <span class="middlename"></span></p>
                    <p><strong><?= lang("Surname")?>:</strong> <span class="surname"></span></p>
                </div>
                <div class="col-md-3">
                    <p><strong><?= lang("Date of Birth")?>:</strong> <span class="date_of_birth"></span></p>
                    <p><strong><?= lang("Date of Death")?>:</strong> <span class="date_of_death"></span></p>
                    <p><strong><?= lang("Gender")?>:</strong> <span class="gender"></span></p>
                    <p><strong><?= lang("Nationality")?>:</strong> <span class="nationality"></span></p>
                    <p><strong><?= lang("Telephone Number")?>:</strong> <span class="telephone_number"></span></p>
                    <p><strong><?= lang("Fax Number")?>:</strong> <span class="fax_number"></span></p>
                </div>
                <div class="col-md-4">
                    <p><strong><?= lang("Mobile Number")?>:</strong> <span class="mobile_number"></span></p>
                    <p><strong><?= lang("Email")?>:</strong> <span class="email"></span></p>
                </div>
            </div>
            <div class="data-info-accordion">
                <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                  <div class="panel panel-default">
                    <div class="panel-heading" role="tab" id="heading-1">
                      <h4 class="panel-title">
                        <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse-1" aria-expanded="true" aria-controls="collapse-1">
                          <?= lang('Authentication') ?>
                        </a>
                      </h4>
                    </div>
                    <div id="collapse-1" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading-1">
                      <div class="panel-body">
                        <div class="table-responsive">
                            <table class="table table-bordered" id="tbl-authentication">
                                <thead>
                                    <tr>
                                        <th class="active"><?=lang('PEP level')?></th>
                                        <th class="active"><?=lang('PEP')?></th>
                                        <th class="active"><?=lang('Previous Sanctions')?></th>
                                        <th class="active"><?=lang('Current Sanctions')?></th>
                                        <th class="active"><?=lang('Law Enforcement')?></th>
                                        <th class="active"><?=lang('Financial Regulator')?></th>
                                        <th class="active"><?=lang('Insolvency')?></th>
                                        <th class="active"><?=lang('Disqualified Director')?></th>
                                        <th class="active"><?=lang('Adverse Media')?></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><span class="pep_level"></span></td>
                                        <td><span class="is_pep"></span></td>
                                        <td><span class="is_sanctions_previous"></span></td>
                                        <td><span class="is_sanctions_current"></span></td>
                                        <td><span class="is_law_enforcement"></span></td>
                                        <td><span class="is_financial_regulator"></span></td>
                                        <td><span class="is_insolvent"></span></td>
                                        <td><span class="is_disqualified_director"></span></td>
                                        <td><span class="is_adverse_media"></span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="panel panel-default">
                    <div class="panel-heading" role="tab" id="heading-2">
                      <h4 class="panel-title">
                        <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse-2" aria-expanded="false" aria-controls="collapse-2">
                          <?= lang('Addresses') ?>
                        </a>
                      </h4>
                    </div>
                    <div id="collapse-2" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading-2">
                      <div class="panel-body">
                        <div class="table-responsive">
                            <table class="table table-bordered dynamic-table" id="tbl-addresses">
                                <thead>
                                    <tr>
                                        <th class="active"><?=lang('Address 1')?></th>
                                        <th class="active"><?=lang('Address 2')?></th>
                                        <th class="active"><?=lang('Address 3')?></th>
                                        <th class="active"><?=lang('Address 4')?></th>
                                        <th class="active"><?=lang('City')?></th>
                                        <th class="active"><?=lang('Country')?></th>
                                        <th class="active"><?=lang('Postcode')?></th>
                                        <th class="active"><?=lang('Country')?></th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="panel panel-default">
                    <div class="panel-heading" role="tab" id="heading-3">
                      <h4 class="panel-title">
                        <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse-3" aria-expanded="false" aria-controls="collapse-3">
                          <?= lang('Aliases') ?>
                        </a>
                      </h4>
                    </div>
                    <div id="collapse-3" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading-3">
                      <div class="panel-body">
                        <div class="table-responsive">
                            <table class="table table-bordered dynamic-table" id="tbl-aliases">
                                <thead>
                                    <tr>
                                        <th class="active"><?=lang('Title')?></th>
                                        <th class="active"><?=lang('Alternative Title')?></th>
                                        <th class="active"><?=lang('Forename')?></th>
                                        <th class="active"><?=lang('Middlename')?></th>
                                        <th class="active"><?=lang('Surname')?></th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="panel panel-default">
                    <div class="panel-heading" role="tab" id="heading-4">
                      <h4 class="panel-title">
                        <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse-4" aria-expanded="false" aria-controls="collapse-4">
                          <?= lang('Articles') ?>
                        </a>
                      </h4>
                    </div>
                    <div id="collapse-4" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading-4">
                      <div class="panel-body">
                        <div class="table-responsive">
                            <table class="table table-bordered dynamic-table" id="tbl-articles">
                                <thead>
                                    <tr>
                                        <th class="active"><?=lang('Title')?></th>
                                        <th class="active"><?=lang('Alternative Title')?></th>
                                        <th class="active"><?=lang('Forename')?></th>
                                        <th class="active"><?=lang('Middlename')?></th>
                                        <th class="active"><?=lang('Surname')?></th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                      </div>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading" role="tab" id="heading-5">
                        <h4 class="panel-title">
                            <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse-5" aria-expanded="false" aria-controls="collapse-5">
                            <?= lang('Sanctions') ?>
                            </a>
                        </h4>
                    </div>
                <div id="collapse-5" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading-5">
                    <div class="panel-body">
                        <div class="table-responsive">
                            <table class="table table-bordered dynamic-table" id="tbl-sanctions">
                                <thead>
                                    <tr>
                                        <th class="active"><?=lang('Sanction Type')?></th>
                                        <th class="active"><?=lang('Is Current')?></th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading" role="tab" id="heading-6">
                        <h4 class="panel-title">
                            <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse-6" aria-expanded="false" aria-controls="collapse-6">
                            <?= lang('Notes') ?>
                            </a>
                        </h4>
                    </div>
                <div id="collapse-6" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading-6">
                    <div class="panel-body">
                        <div class="table-responsive">
                            <table class="table table-bordered dynamic-table" id="tbl-notes">
                                <thead>
                                    <tr>
                                        <th class="active"><?=lang('Data Source')?></th>
                                        <th class="active"><?=lang('Text')?></th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading" role="tab" id="heading-7">
                        <h4 class="panel-title">
                            <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse-7" aria-expanded="false" aria-controls="collapse-7">
                            <?= lang('Linked Businesses') ?>
                            </a>
                        </h4>
                    </div>
                <div id="collapse-7" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading-7">
                    <div class="panel-body">
                        <div class="table-responsive">
                            <table class="table table-bordered dynamic-table" id="tbl-linked_businesses">
                                <thead>
                                    <tr>
                                        <th class="active"><?=lang('Business ID')?></th>
                                        <th class="active"><?=lang('Business Name')?></th>
                                        <th class="active"><?=lang('Position')?></th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading" role="tab" id="heading-8">
                        <h4 class="panel-title">
                            <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse-8" aria-expanded="false" aria-controls="collapse-8">
                            <?= lang('Linked Persons') ?>
                            </a>
                        </h4>
                    </div>
                <div id="collapse-8" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading-8">
                    <div class="panel-body">
                        <div class="table-responsive">
                            <table class="table table-bordered dynamic-table" id="tbl-linked_person">
                                <thead>
                                    <tr>
                                        <th class="active"><?=lang('Person ID')?></th>
                                        <th class="active"><?=lang('Name')?></th>
                                        <th class="active"><?=lang('Association')?></th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading" role="tab" id="heading-9">
                        <h4 class="panel-title">
                            <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse-9" aria-expanded="false" aria-controls="collapse-9">
                            <?= lang('Political Positions') ?>
                            </a>
                        </h4>
                    </div>
                <div id="collapse-9" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading-8">
                    <div class="panel-body">
                        <div class="table-responsive">
                            <table class="table table-bordered dynamic-table" id="tbl-political_positions">
                                <thead>
                                    <tr>
                                        <th class="active"><?=lang('Description')?></th>
                                        <th class="active"><?=lang('From')?></th>
                                        <th class="active"><?=lang('To')?></th>
                                        <th class="active"><?=lang('Country')?></th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<?php if($this->utils->isEnabledFeature('export_excel_on_queue')){?>
<form id="_export_excel_queue_form" class="hidden" method="POST" target="_blank">
<input name='json_search' type="hidden">
</form>
<?php }?>

<script type="text/javascript">
    $(document).ready(function() {
        $('#pep_status').text('<?=$current_pep_status?>');
        $('#risk_score').text('<?=$total_score?>');
        $('#allowed_withdrawal_status').text('<?=$allowed_withdrawal_status?>');
        $('#c6_status').text('<?=$current_c6_status?>');
    });

    function manual_player_c6_status() {
        if(confirm("<?= lang('Are you sure you want to generate C6 Authentication manually?'); ?>")) {
            $.post("/player_management/generate_manual_c6_authentication/<?=$playerId?>/true", function(result){
                if(result.status == "success"){
                    alert(result.msg);
                    modal('/player_management/player_c6_authentication/<?=$playerId?>','<?=lang('C6 Authentication')?>');
                } else {
                    alert(result.msg);
                }
            });
        }
    }

    function autoUpdatePlayerStatus(){
        var status = $("#chkAutoUpdatePlayerStatus").is(":checked");
        if(confirm("<?= lang('Are you sure you want to continue?'); ?>")) {
            $.post("/player_management/edit_update_auto_update_pep/<?=$playerId?>/"+status, function(result){
                if(result.status == "success"){
                    alert(result.msg);
                    modal('/player_management/player_c6_authentication/<?=$playerId?>','<?=lang('C6 Authentication')?>');
                } else {
                    alert(result.msg);
                }
            });
        }
    }

    function view_details(info_id){
        $.post("/player_management/get_acuris_c6_info_by_id/"+info_id, function(result){
            if(result.status == "error"){
                alert(result.msg);
            } else {
                $(".image_url").attr("src",result['image_url']);
                
                $(".basic_info_elements").find("span").each(function( index ) {
                    value = $( this ).attr('class')
                    $("."+value).text(( result[value] == null || result[value].length === 0 ) ? 'N/A' : result[value]);
                });

                $("#tbl-authentication").find("span").each(function( index ) {
                    value = $( this ).attr('class')
                    $("."+value).text(( result[value] == null || result[value].length === 0 ) ? 'N/A' : result[value]);
                });

                //Dynamic load all accordion panel
                $(".data-info-accordion .dynamic-table").each(function() {
                   var element_id = $(this).attr('id');

                   var response = {
                                "data": result[element_id.replace('tbl-', '')]
                                };

                    $('#'+element_id).DataTable({
                        "pageLength": 10,
                        autoWidth: false,
                        searching: true,
                        ajax: function (data, callback, settings) {
                            callback(response);
                        }
                    });

                 });

                document.getElementById("overlay").style.width = "100%";
            }
        });
    }

    function close_details(){
        document.getElementById("overlay").style.width = "0%";
        $(".data-info-accordion .dynamic-table").each(function() {
            $('#'+$(this).attr('id')).DataTable().destroy();
        });
    }
</script>

<script type="text/javascript">
    $(document).ready(function(){
         var dataTable = $('#c6-auth-table').DataTable({
            "pageLength": 10,
            autoWidth: false,
            searching: true,
            dom: "<'panel-body' <'pull-right'B><'pull-right'f><'pull-right progress-container'>l><'dt-information-summary1 text-info pull-left' i>t<'panel-body'<'pull-right'p><'dt-information-summary2 text-info pull-left' i>>",
            buttons: [
                {
                    extend: 'colvis',
                    postfixButtons: [ 'colvisRestore' ],
                    className:'btn btn-sm '
                }
                <?php if( $this->permissions->checkPermissions('export_game_logs') ) { ?>
                ,{

                    text: "<?php echo lang('CSV Export'); ?>",
                    className:'btn btn-sm btn-primary',
                    action: function ( e, dt, node, config ) {

                        var d = {'extra_search':$('#search-form').serializeArray(), 'draw':1, 'length':-1, 'start':0};

                        $("#_export_excel_queue_form").attr('action', site_url('/export_data/kyc_c6_acuris_by_player_report'));
                        $("#_export_excel_queue_form [name=json_search]").val(JSON.stringify(d));
                        $("#_export_excel_queue_form").submit();

                    }
                }
                <?php } ?>
            ],
            order: [[0, 'desc']],
            ajax: function (data, callback, settings) {

                data.extra_search = [
                    {
                        'name':'by_player_id',
                        'value': '<?=$playerId?>'
                    }
                ];

                $.post(base_url + 'api/kyc_c6_acuris_by_player_report/', data, function(data) {
                    callback(data);
                },'json');
            }
        });
    });
</script>